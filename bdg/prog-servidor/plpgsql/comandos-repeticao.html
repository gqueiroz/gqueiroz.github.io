<!DOCTYPE html>
<html class="writer-html5" lang="pt-BR" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7.1.8. Comandos de Repetição &mdash; BDGeo</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/table_styling.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/bd-geoespacial.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="canonical" href="https://prog-geo.github.io/prog-servidor/plpgsql/comandos-repeticao.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Buscar" href="../../search.html" />
    <link rel="next" title="7.1.9. Blocos" href="blocos.html" />
    <link rel="prev" title="7.1.7. Retornando Conjuntos ou Tuplas" href="return-tuplas.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #F0F8FF" >
            <a href="../../index.html" class="icon icon-home"> BDGeo
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Pesquisar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Menu de navegação">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Bancos de Dados Geográficos</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Aulas:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../instalacao/index.html">1. Instalando e Configurando o Ambiente de Trabalho</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sgbd/index.html">2. Sistemas de Bancos de Dados Relacionais</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tipos-geometricos/index.html">3. Tipos de Dados e Operações Espaciais</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../estrutura-dados/index.html">4. Estruturas de Dados e Métodos de Acesso Multidimensionais</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../algo-geom/index.html">5. Algoritmos Geométricos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json/index.html">6. JSON (Java Script Object Notation)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">7. Programação do Lado Servidor no PostgreSQL</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">7.1. PL/pgSQL</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introducao.html">7.1.1. Introdução</a></li>
<li class="toctree-l3"><a class="reference internal" href="comentarios.html">7.1.2. Comentários</a></li>
<li class="toctree-l3"><a class="reference internal" href="estruturas-condicionais.html">7.1.3. Estruturas Condicionais</a></li>
<li class="toctree-l3"><a class="reference internal" href="msg-excecoes.html">7.1.4. Mensagens e Exceções</a></li>
<li class="toctree-l3"><a class="reference internal" href="parametros.html">7.1.5. Tipos dos Parâmetros e Tipo de Retorno</a></li>
<li class="toctree-l3"><a class="reference internal" href="exec-sql.html">7.1.6. Execução de Comandos SQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="return-tuplas.html">7.1.7. Retornando Conjuntos ou Tuplas</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">7.1.8. Comandos de Repetição</a></li>
<li class="toctree-l3"><a class="reference internal" href="blocos.html">7.1.9. Blocos</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../triggers.html">7.2. Triggers e Relacionamentos de Integridade Espacial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensoes.html">7.3. Extensões</a></li>
<li class="toctree-l2"><a class="reference internal" href="../consideracoes.html">7.4. Considerações Finais</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tips/index.html">8. Dicas</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Referências Bibliográficas</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../referencias.html">Referências Bibliográficas</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Listas de Exercícios:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../listas.html">Listas de Exercícios</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Informações Gerais:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../licenca.html">Licença</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Agradecimentos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../agradecimentos.html">Agradecimentos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Menu de navegação móvel"  style="background: #F0F8FF" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BDGeo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Navegação da página">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">7. </span>Programação do Lado Servidor no PostgreSQL</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">7.1. </span>PL/pgSQL</a> &raquo;</li>
      <li><span class="section-number">7.1.8. </span>Comandos de Repetição</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Navegação sequencial da página">
        <a href="return-tuplas.html" class="btn btn-neutral float-left" title="7.1.7. Retornando Conjuntos ou Tuplas" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="blocos.html" class="btn btn-neutral float-right" title="7.1.9. Blocos" accesskey="n">Próximo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="comandos-de-repeticao">
<h1><span class="section-number">7.1.8. </span>Comandos de Repetição<a class="headerlink" href="#comandos-de-repeticao" title="Link permanente para este cabeçalho"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">PL/pgSQL</span></code> possui diversos tipos de estruturas para laços de repetição: <code class="docutils literal notranslate"><span class="pre">LOOP</span></code>, <code class="docutils literal notranslate"><span class="pre">WHILE</span></code>, <code class="docutils literal notranslate"><span class="pre">FOR</span></code> e <code class="docutils literal notranslate"><span class="pre">FOREACH</span></code>. Além de comandos para desvio do fluxo de instruções: <code class="docutils literal notranslate"><span class="pre">EXIT</span></code> e <code class="docutils literal notranslate"><span class="pre">CONTINUE</span></code>.</p>
<section id="for-com-variavel-de-controle-do-tipo-inteiro">
<h2><span class="section-number">7.1.8.1. </span><code class="docutils literal notranslate"><span class="pre">FOR</span></code> com variável de controle do tipo inteiro<a class="headerlink" href="#for-com-variavel-de-controle-do-tipo-inteiro" title="Link permanente para este cabeçalho"></a></h2>
<p>Uma das variantes do laço tipo <code class="docutils literal notranslate"><span class="pre">FOR</span></code> possibilita iterar em uma variável do tipo inteiro. Como exemplo deste tipo de laço, vamos criar uma função para computar um certo número de pontos posicionados de forma aleatória. Este exemplo irá mostrar também como retornar um conjunto de registros. No caso, os registros terão o seguinte esquema: <code class="docutils literal notranslate"><span class="pre">(INTEGER,</span> <span class="pre">GEOMETRY)</span></code>.</p>
<div class="highlight-plpgsql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">random_pt_generator</span><span class="p">(</span><span class="n">npts</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">)</span><span class="w"></span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="nb">RECORD</span><span class="w"></span>
<span class="k">AS</span><span class="w"> </span><span class="s">$$</span><span class="w"></span>
<span class="k">DECLARE</span><span class="w"></span>
<span class="w">    </span><span class="n">tupla</span><span class="w"> </span><span class="nb">RECORD</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">longitude</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">latitude</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">pt</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="p">;</span><span class="w"></span>
<span class="k">BEGIN</span><span class="w"></span>
<span class="w">    </span><span class="k">RAISE</span><span class="w"> </span><span class="k">NOTICE</span><span class="w"> </span><span class="s1">&#39;Computando % pontos aleatórios...&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">npts</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">FOR</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="mf">1..</span><span class="n">npts</span><span class="w"> </span><span class="k">LOOP</span><span class="w"></span>
<span class="w">        </span><span class="n">longitude</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">360.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">180.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">latitude</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">180.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">90.0</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">pt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_MakePoint</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">latitude</span><span class="p">),</span><span class="w"> </span><span class="mf">4326</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">tupla</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">pt</span><span class="p">);</span><span class="w">  </span><span class="c1">-- ou: SELECT i, pt INTO tupla;</span>

<span class="w">        </span><span class="k">RETURN</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="n">tupla</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="w">            </span><span class="k">RAISE</span><span class="w"> </span><span class="k">NOTICE</span><span class="w"> </span><span class="s1">&#39;random_pt_generator: iteração %&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">LOOP</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">RETURN</span><span class="p">;</span><span class="w"></span>
<span class="k">END</span><span class="p">;</span><span class="w"></span>
<span class="s">$$</span><span class="w"></span>
<span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>A função <code class="docutils literal notranslate"><span class="pre">random_pt_generator</span></code> ilustra também um tipo de função que não pode ser utilizada somente na cláusula <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> pois ela retorna um conjunto de tuplas. Neste caso, deve-se utilizar a função na cláusula <code class="docutils literal notranslate"><span class="pre">FROM</span></code>, mas com um cuidado especial, que é definir o tipo do conjunto retornado. Abaixo, mostramos como criar uma consulta que computa 5 pontos:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">gid</span><span class="p">,</span><span class="w"> </span><span class="n">ST_AsText</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">random_pt_generator</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tabela</span><span class="p">(</span><span class="n">gid</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Saída:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Computando</span> <span class="mi">5</span> <span class="n">pontos</span> <span class="n">aleatórios</span><span class="o">...</span>

 <span class="n">gid</span> <span class="o">|</span>                 <span class="n">st_astext</span>
<span class="o">-----+--------------------------------------------</span>
   <span class="mi">1</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="mf">25.8069811575115</span> <span class="mf">4.40172334201634</span><span class="p">)</span>
   <span class="mi">2</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="o">-</span><span class="mf">31.4398757368326</span> <span class="mf">18.4167264495045</span><span class="p">)</span>
   <span class="mi">3</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="o">-</span><span class="mf">42.4448257684708</span> <span class="o">-</span><span class="mf">74.7917356621474</span><span class="p">)</span>
   <span class="mi">4</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="mf">12.7397736534476</span> <span class="o">-</span><span class="mf">52.6765340007842</span><span class="p">)</span>
   <span class="mi">5</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="mf">87.8538537584245</span> <span class="o">-</span><span class="mf">22.9236561711878</span><span class="p">)</span>
 <span class="p">(</span><span class="mi">5</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="for-sobre-o-resultado-de-uma-consulta">
<h2><span class="section-number">7.1.8.2. </span><code class="docutils literal notranslate"><span class="pre">FOR</span></code> sobre o resultado de uma consulta<a class="headerlink" href="#for-sobre-o-resultado-de-uma-consulta" title="Link permanente para este cabeçalho"></a></h2>
<p>Outro tipo de laço <code class="docutils literal notranslate"><span class="pre">FOR</span></code> pode ser empregado para iterar nas tuplas resultantes de uma consulta. Para ilustrar este tipo de laço, vamos construir uma função chamada <code class="docutils literal notranslate"><span class="pre">build_pt_table</span></code> que irá criar uma tabela geométrica com pontos gerados de forma aleatória usando como base nossa função <code class="docutils literal notranslate"><span class="pre">random_pt_generator</span></code>. Ao final esta função irá criar uma chave primária e um índice espacial sobre a coluna geométrica da tabela criada.</p>
<div class="highlight-plpgsql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">build_pt_table</span><span class="p">(</span><span class="n">table_name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"></span>
<span class="w">                                          </span><span class="n">npts</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">)</span><span class="w"></span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">VOID</span><span class="w"></span>
<span class="k">AS</span><span class="w"></span>
<span class="s">$$</span><span class="w"></span>
<span class="k">DECLARE</span><span class="w"></span>
<span class="w">    </span><span class="n">tupla</span><span class="w"> </span><span class="nb">RECORD</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="w">     </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"></span>
<span class="k">BEGIN</span><span class="w"></span>
<span class="w">    </span><span class="k">RAISE</span><span class="w"> </span><span class="k">NOTICE</span><span class="w"> </span><span class="s1">&#39;Criando tabela %...&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">table_name</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">EXECUTE</span><span class="w"> </span><span class="s1">&#39;CREATE TABLE &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">table_name</span><span class="w"> </span><span class="o">||</span><span class="w"></span>
<span class="w">            </span><span class="s1">&#39;(gid INTEGER, geom GEOMETRY(POINT,4326))&#39;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">FOR</span><span class="w"> </span><span class="n">tupla</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="w">                   </span><span class="k">FROM</span><span class="w"> </span><span class="n">random_pt_generator</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tabela</span><span class="p">(</span><span class="n">gid</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="k">LOOP</span><span class="w"></span>
<span class="w">        </span><span class="k">EXECUTE</span><span class="w"> </span><span class="s1">&#39;INSERT INTO &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">table_name</span><span class="w"> </span><span class="o">||</span><span class="w"></span>
<span class="w">                </span><span class="s1">&#39;(gid, geom) VALUES($1, $2)&#39;</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">tupla</span><span class="mf">.</span><span class="n">gid</span><span class="p">,</span><span class="w"> </span><span class="n">tupla</span><span class="mf">.</span><span class="n">geom</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="w">            </span><span class="k">RAISE</span><span class="w"> </span><span class="k">NOTICE</span><span class="w"> </span><span class="s1">&#39;Inseridos % tuplas!&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">LOOP</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">RAISE</span><span class="w"> </span><span class="k">NOTICE</span><span class="w"> </span><span class="s1">&#39;Criando chave primária...&#39;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">EXECUTE</span><span class="w"> </span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ALTER TABLE %I ADD PRIMARY KEY(gid)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">table_name</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">RAISE</span><span class="w"> </span><span class="k">NOTICE</span><span class="w"> </span><span class="s1">&#39;Criando índice espacial...&#39;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">EXECUTE</span><span class="w"> </span><span class="s1">&#39;CREATE INDEX spidx_&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">table_name</span><span class="w"> </span><span class="o">||</span><span class="w"></span>
<span class="w">    </span><span class="s1">&#39;_geom ON &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">table_name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39; USING GIST(geom)&#39;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">RETURN</span><span class="p">;</span><span class="w"></span>
<span class="k">END</span><span class="p">;</span><span class="w"></span>
<span class="s">$$</span><span class="w"></span>
<span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Usando a função <code class="docutils literal notranslate"><span class="pre">build_pt_table</span></code>, vamos criar uma tabela chamada <code class="docutils literal notranslate"><span class="pre">pt10k</span></code> contendo 10.000 pontos:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">build_pt_table</span><span class="p">(</span><span class="s1">&#39;pt10k&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Saída:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>NOTICE:  Criando tabela pt10k...
NOTICE:  Computando 10000 pontos aleatórios...
...
NOTICE:  Inseridos 1000 tuplas!
NOTICE:  Inseridos 2000 tuplas!
NOTICE:  Inseridos 3000 tuplas!
NOTICE:  Inseridos 4000 tuplas!
NOTICE:  Inseridos 5000 tuplas!
NOTICE:  Inseridos 6000 tuplas!
NOTICE:  Inseridos 7000 tuplas!
NOTICE:  Inseridos 8000 tuplas!
NOTICE:  Inseridos 9000 tuplas!
NOTICE:  Inseridos 10000 tuplas!
NOTICE:  Criando chave primária...
NOTICE:  Criando índice espacial...
build_pt_table
----------------

(1 row)
</pre></div>
</div>
<p>Outra forma útil deste tipo de <code class="docutils literal notranslate"><span class="pre">FOR</span></code> utiliza o comando <code class="docutils literal notranslate"><span class="pre">EXECUTE</span></code>:</p>
<div class="highlight-plpgsql notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nl">&lt;&lt;rótulo&gt;&gt;</span><span class="p">]</span><span class="w"></span>
<span class="k">FOR</span><span class="w"> </span><span class="n">variável</span><span class="o">-</span><span class="n">tupla</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">query</span><span class="o">-</span><span class="n">string</span><span class="w"> </span><span class="p">[</span><span class="k">USING</span><span class="w"> </span><span class="n">expressão</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="mf">...</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="k">LOOP</span><span class="w"></span>
<span class="w">    </span><span class="n">comandos</span><span class="p">;</span><span class="w"></span>
<span class="k">END</span><span class="w"> </span><span class="k">LOOP</span><span class="w"> </span><span class="p">[</span><span class="n">rótulo</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="while">
<h2><span class="section-number">7.1.8.3. </span><code class="docutils literal notranslate"><span class="pre">WHILE</span></code><a class="headerlink" href="#while" title="Link permanente para este cabeçalho"></a></h2>
<div class="highlight-plpgsql notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nl">&lt;&lt;rótulo&gt;&gt;</span><span class="p">]</span><span class="w"></span>
<span class="k">WHILE</span><span class="w"> </span><span class="n">expressão</span><span class="o">-</span><span class="n">booleana</span><span class="w"> </span><span class="k">LOOP</span><span class="w"></span>
<span class="w">    </span><span class="n">comandos</span><span class="p">;</span><span class="w"></span>
<span class="k">END</span><span class="w"> </span><span class="k">LOOP</span><span class="w"> </span><span class="p">[</span><span class="n">rótulo</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="loop-repeticoes-incondicionais">
<h2><span class="section-number">7.1.8.4. </span><code class="docutils literal notranslate"><span class="pre">LOOP</span></code>: repetições incondicionais<a class="headerlink" href="#loop-repeticoes-incondicionais" title="Link permanente para este cabeçalho"></a></h2>
<div class="highlight-plpgsql notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nl">&lt;&lt;rótulo&gt;&gt;</span><span class="p">]</span><span class="w"></span>
<span class="k">LOOP</span><span class="w"></span>
<span class="w">    </span><span class="n">comandos</span><span class="p">;</span><span class="w"></span>
<span class="k">END</span><span class="w"> </span><span class="k">LOOP</span><span class="w"> </span><span class="p">[</span><span class="n">rótulo</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="exit-interrompendo-um-laco-ou-bloco-de-comandos">
<h2><span class="section-number">7.1.8.5. </span><code class="docutils literal notranslate"><span class="pre">EXIT</span></code>: interrompendo um laço ou bloco de comandos<a class="headerlink" href="#exit-interrompendo-um-laco-ou-bloco-de-comandos" title="Link permanente para este cabeçalho"></a></h2>
<div class="highlight-plpgsql notranslate"><div class="highlight"><pre><span></span><span class="k">EXIT</span><span class="w"> </span><span class="p">[</span><span class="n">rótulo</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">WHEN</span><span class="w"> </span><span class="n">expressão</span><span class="o">-</span><span class="n">booleana</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="continue-desviando-o-fluxo-de-uma-laco">
<h2><span class="section-number">7.1.8.6. </span><code class="docutils literal notranslate"><span class="pre">CONTINUE</span></code>: desviando o fluxo de uma laço<a class="headerlink" href="#continue-desviando-o-fluxo-de-uma-laco" title="Link permanente para este cabeçalho"></a></h2>
<div class="highlight-plpgsql notranslate"><div class="highlight"><pre><span></span><span class="k">CONTINUE</span><span class="w"> </span><span class="p">[</span><span class="n">rótulo</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">WHEN</span><span class="w"> </span><span class="n">expressão</span><span class="o">-</span><span class="n">booleana</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="foreach-iterando-sobre-arrays">
<h2><span class="section-number">7.1.8.7. </span><code class="docutils literal notranslate"><span class="pre">FOREACH</span></code>: iterando sobre arrays<a class="headerlink" href="#foreach-iterando-sobre-arrays" title="Link permanente para este cabeçalho"></a></h2>
<div class="highlight-plpgsql notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nl">&lt;&lt;rótulo&gt;&gt;</span><span class="p">]</span><span class="w"></span>
<span class="k">FOREACH</span><span class="w"> </span><span class="n">variável</span><span class="w"> </span><span class="p">[</span><span class="n">SLICE</span><span class="w"> </span><span class="n">número</span><span class="p">]</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">ARRAY</span><span class="w"> </span><span class="n">expressão</span><span class="o">-</span><span class="k">array</span><span class="w"> </span><span class="k">LOOP</span><span class="w"></span>
<span class="w">    </span><span class="n">comandos</span><span class="p">;</span><span class="w"></span>
<span class="k">END</span><span class="w"> </span><span class="k">LOOP</span><span class="w"> </span><span class="p">[</span><span class="n">rótulo</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Rodapé">
        <a href="return-tuplas.html" class="btn btn-neutral float-left" title="7.1.7. Retornando Conjuntos ou Tuplas" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="blocos.html" class="btn btn-neutral float-right" title="7.1.9. Blocos" accesskey="n" rel="next">Próximo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Gilberto Queiroz.</p>
  </div>

  
<jinja2.runtime.BlockReference object at 0x7f7114a21040>
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png" width="117" height="41"/></a> This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons “Attribution-NonCommercial-ShareAlike 4.0 International” license</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-165908761-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-165908761-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>