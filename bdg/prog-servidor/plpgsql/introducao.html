<!DOCTYPE html>
<html class="writer-html5" lang="pt-BR" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5.1.1. Introdução &mdash; BDGeo</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/table_styling.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/bd-geoespacial.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="canonical" href="https://prog-geo.github.io/prog-servidor/plpgsql/introducao.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Buscar" href="../../search.html" />
    <link rel="next" title="5.1.2. Comentários" href="comentarios.html" />
    <link rel="prev" title="5.1. PL/pgSQL" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #F0F8FF" >
            <a href="../../index.html" class="icon icon-home"> BDGeo
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Pesquisar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Menu de navegação">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Bancos de Dados Geográficos</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Aulas:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../instalacao/index.html">1. Instalando e Configurando o Ambiente de Trabalho</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sgbd/index.html">2. Sistemas de Bancos de Dados Relacionais</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tipos-geometricos/index.html">3. Tipos de Dados e Operações Espaciais</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../consultas-espaciais/index.html">4. Consultas Espaciais</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">5. Programação do Lado Servidor no PostgreSQL</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">5.1. PL/pgSQL</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">5.1.1. Introdução</a></li>
<li class="toctree-l3"><a class="reference internal" href="comentarios.html">5.1.2. Comentários</a></li>
<li class="toctree-l3"><a class="reference internal" href="estruturas-condicionais.html">5.1.3. Estruturas Condicionais</a></li>
<li class="toctree-l3"><a class="reference internal" href="msg-excecoes.html">5.1.4. Mensagens e Exceções</a></li>
<li class="toctree-l3"><a class="reference internal" href="parametros.html">5.1.5. Tipos dos Parâmetros e Tipo de Retorno</a></li>
<li class="toctree-l3"><a class="reference internal" href="exec-sql.html">5.1.6. Execução de Comandos SQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="return-tuplas.html">5.1.7. Retornando Conjuntos ou Tuplas</a></li>
<li class="toctree-l3"><a class="reference internal" href="comandos-repeticao.html">5.1.8. Comandos de Repetição</a></li>
<li class="toctree-l3"><a class="reference internal" href="blocos.html">5.1.9. Blocos</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../triggers.html">5.2. Triggers e Relacionamentos de Integridade Espacial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extensoes.html">5.3. Extensões</a></li>
<li class="toctree-l2"><a class="reference internal" href="../consideracoes.html">5.4. Considerações Finais</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../estrutura-dados/index.html">6. Estruturas de Dados e Métodos de Acesso Multidimensionais</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../algo-geom/index.html">7. Algoritmos Geométricos</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Referências Bibliográficas</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../referencias.html">Referências Bibliográficas</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Listas de Exercícios:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../listas.html">Listas de Exercícios</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Informações Gerais:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../licenca.html">Licença</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Agradecimentos:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../agradecimentos.html">Agradecimentos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Menu de navegação móvel"  style="background: #F0F8FF" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BDGeo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Navegação da página">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">5. </span>Programação do Lado Servidor no PostgreSQL</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">5.1. </span>PL/pgSQL</a> &raquo;</li>
      <li><span class="section-number">5.1.1. </span>Introdução</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Navegação sequencial da página">
        <a href="index.html" class="btn btn-neutral float-left" title="5.1. PL/pgSQL" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="comentarios.html" class="btn btn-neutral float-right" title="5.1.2. Comentários" accesskey="n">Próximo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introducao">
<h1><span class="section-number">5.1.1. </span>Introdução<a class="headerlink" href="#introducao" title="Link permanente para este cabeçalho"></a></h1>
<p>A Linguagem <code class="docutils literal notranslate"><span class="pre">PL/pgSQL</span></code><a class="footnote-reference brackets" href="#f1" id="id1">1</a> permite que comandos SQL sejam executados dentro de uma linguagem procedural, isto é, de uma linguagem com comandos de decisão (<em>if-then-else</em>) e repetição (laços <em>do-while</em>), e que facilita o trabalho de manipulação do resultado da execução de consultas.</p>
<p>A sintaxe geral de funções em <code class="docutils literal notranslate"><span class="pre">PL/pgSQL</span></code> é a seguinte<a class="footnote-reference brackets" href="#f2" id="id2">2</a><sup>,</sup><a class="footnote-reference brackets" href="#f3" id="id3">3</a>:</p>
<div class="highlight-plpgsql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">nome</span><span class="o">-</span><span class="n">da</span><span class="o">-</span><span class="n">função</span><span class="p">(</span><span class="n">parâmetros</span><span class="p">)</span><span class="w"></span>
<span class="k">RETURNS</span><span class="w"> </span><span class="n">tipo</span><span class="o">-</span><span class="n">retorno</span><span class="w"></span>
<span class="k">AS</span><span class="w"></span>
<span class="s">$$</span><span class="w"></span>
<span class="p">[</span><span class="nl">&lt;&lt;rótulo&gt;&gt;</span><span class="p">]</span><span class="w"></span>
<span class="p">[</span><span class="k">DECLARE</span><span class="w"></span>
<span class="w">    </span><span class="n">lista</span><span class="o">-</span><span class="n">variáveis</span><span class="p">;]</span><span class="w"></span>
<span class="k">BEGIN</span><span class="w"></span>
<span class="w">    </span><span class="n">comandos</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="k">EXCEPTION</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="k">WHEN</span><span class="w"> </span><span class="n">condição</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="w">            </span><span class="n">comandos</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="mf">...</span><span class="p">]]</span><span class="w"></span>
<span class="k">END</span><span class="w"> </span><span class="p">[</span><span class="n">rótulo</span><span class="p">];</span><span class="w"></span>
<span class="s">$$</span><span class="w"></span>
<span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Vamos começar criando uma função chamada <code class="docutils literal notranslate"><span class="pre">my_distance</span></code> capaz de computar a distância euclideana entre dois pontos. O código desta função é mostrado a seguir:</p>
<div class="highlight-plpgsql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">my_distance</span><span class="p">(</span><span class="k">first</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="p">,</span><span class="w"></span>
<span class="w">                                       </span><span class="k">second</span><span class="w"> </span><span class="n">GEOMETRY</span><span class="p">)</span><span class="w"></span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="w"></span>
<span class="k">AS</span><span class="w"></span>
<span class="s">$$</span><span class="w"></span>
<span class="k">DECLARE</span><span class="w"></span>
<span class="w">    </span><span class="n">dx</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">dy</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">d</span><span class="w">  </span><span class="nb">NUMERIC</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="k">BEGIN</span><span class="w"></span>
<span class="w">    </span><span class="n">dx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ST_X</span><span class="p">(</span><span class="k">first</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ST_X</span><span class="p">(</span><span class="k">second</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">dy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ST_Y</span><span class="p">(</span><span class="k">first</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ST_Y</span><span class="p">(</span><span class="k">second</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">power</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">power</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"></span>
<span class="k">END</span><span class="p">;</span><span class="w"></span>
<span class="s">$$</span><span class="w"></span>
<span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>As funções <code class="docutils literal notranslate"><span class="pre">PL/pgSQL</span></code> podem ser usadas em qualquer parte das consultas SQL onde uma função comum possa ser incluída. Uma vez criada, uma função pode ser chamada de dentro de uma consulta submetida tanto do lado cliente quanto do lado servidor. No entanto, a execução da função ocorrerá sempre do lado servidor.</p>
<p>Para executar a função <code class="docutils literal notranslate"><span class="pre">my_distance</span></code> podemos utilizar uma consulta do tipo <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> usando uma das duas construções:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">my_distance</span><span class="p">(</span><span class="w"></span>
<span class="w">           </span><span class="n">ST_GeometryFromText</span><span class="p">(</span><span class="s1">&#39;POINT(0 0)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">),</span><span class="w"></span>
<span class="w">           </span><span class="n">ST_GeometryFromText</span><span class="p">(</span><span class="s1">&#39;POINT(1 1)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>ou:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">my_distance</span><span class="p">(</span><span class="w"></span>
<span class="w">           </span><span class="n">ST_GeometryFromText</span><span class="p">(</span><span class="s1">&#39;POINT(0 0)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">),</span><span class="w"></span>
<span class="w">           </span><span class="n">ST_GeometryFromText</span><span class="p">(</span><span class="s1">&#39;POINT(1 1)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p class="rubric">Notas</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><em>PL</em> vem de <em>Programming Language</em>.</p>
</dd>
<dt class="label" id="f2"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Para maiores detalhes da sintaxe da linguagem <code class="docutils literal notranslate"><span class="pre">PL/pgSQL</span></code>, consulte <span class="xref std std-ref">Postgresql 9.5.3 documentation - chapter 40. pl/pgsql - sql procedural language</span>.</p>
</dd>
<dt class="label" id="f3"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>As partes entre <code class="docutils literal notranslate"><span class="pre">[</span></code> e <code class="docutils literal notranslate"><span class="pre">]</span></code> são opcionais.</p>
</dd>
</dl>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Rodapé">
        <a href="index.html" class="btn btn-neutral float-left" title="5.1. PL/pgSQL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="comentarios.html" class="btn btn-neutral float-right" title="5.1.2. Comentários" accesskey="n" rel="next">Próximo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Gilberto Queiroz.</p>
  </div>

  
<jinja2.runtime.BlockReference object at 0x7fe9a8bd9400>
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png" width="117" height="41"/></a> This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons “Attribution-NonCommercial-ShareAlike 4.0 International” license</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-165908761-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-165908761-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>