..
    This file is part of "Notas de Aula do Curso Bancos de Dados Geográficos".
    Copyright 2020-2022, Gilberto Queiroz.


.. _cap_sgbd_consultas_agreg:

Consultas de Agregação
======================

Temos vários operadores que trabalham com grupos de registros, sendo muito úteis para uso com a cláusula ``GROUP BY``:

.. rst-class:: open

- ``AVG``: média dos valores da coluna.

- ``SUM``: soma dos valores da coluna.

- ``COUNT``: número de valores na coluna.

- ``MAX``: maior valor na coluna.

- ``MIN``: menor valor na coluna.


Exemplos
--------


Para os exemplos dessa seção, vamos acrescentar mais algumas linhas na nossa tabela chamada ``alunos``:


.. code-block:: sql

    INSERT INTO alunos (nome, curso_id)
                VALUES ('Telma', 3),
                       ('antoNio', 4),
                       ('Maria', 1),
                       ('Marta', 1),
                       ('Murilo', 2),
                       ('Alice', 2),
                       ('Mauricio', 1),
                       ('Jonas', 4),
                       ('José', 4),
                       ('Ronaldo', 4);

    INSERT INTO alunos (nome, curso_id)
                VALUES ('edson', 2);

    INSERT INTO alunos (nome, curso_id)
                VALUES ('eduardo', 3);

    INSERT INTO alunos (nome, curso_id)
                VALUES ('cassia', 4);


**1.** Quantos cursos são oferecidos?

    .. collapse:: Solução:

        .. code-block:: sql

            SELECT COUNT(*) FROM cursos;


**2.** Qual o número de alunos ?

    .. collapse:: Solução:

        .. code-block:: sql

            SELECT COUNT(*) FROM alunos;


**3.** Quantos alunos estão matriculados em cada curso?

    .. collapse:: Solução:

        .. code-block:: sql

              SELECT cursos.curso_id, COUNT(*) AS numero_alunos
                FROM cursos, alunos
               WHERE cursos.curso_id = alunos.curso_id
            GROUP BY cursos.curso_id;


        ou, incluindo o nome do curso no resultado de saída e ordenando pelo nome do curso:


        .. code-block:: sql

              SELECT cursos.titulo, COUNT(*) AS numero_alunos
                FROM cursos, alunos
               WHERE cursos.curso_id = alunos.curso_id
            GROUP BY cursos.curso_id, cursos.titulo
            ORDER BY 1;


**4.** Quais cursos possuem mais de 03 alunos?

    .. collapse:: Solução:


        .. code-block:: sql

              SELECT cursos.titulo, COUNT(*) AS numero_alunos
                FROM cursos, alunos
               WHERE cursos.curso_id = alunos.curso_id
            GROUP BY cursos.curso_id, cursos.titulo
              HAVING COUNT(*) > 3
            ORDER BY 1;
